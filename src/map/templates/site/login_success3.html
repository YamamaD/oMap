{% extends "base.html" %}

{% block title%}Map{% endblock %}
{% block javascript %}
    <script src="http://openlayers.org/api/OpenLayers.js"></script>
    <script type="text/javascript">
        var mapa, layer;

        function init(){
            OpenLayers.ProxyHost="/proxy/?url=";
            mapa = new OpenLayers.Map('mapa');
            layer = new OpenLayers.Layer.WMS( "OpenLayers WMS",
                "http://vmap0.tiles.osgeo.org/wms/vmap0", {layers: 'basic'} );


            mapa.addLayer(layer);
            mapa.setCenter(new OpenLayers.LonLat(35, 32), 8);
            
            var markers = new OpenLayers.Layer.Markers( "Markers" );
            mapa.addLayer(markers);

            var x = null;
            var y = null;
         //   var msg = null;


            {% for p in points %}
            {   x = "{{p.point.x}}";
                y = "{{p.point.y}}";
                //var msg2 = "{{points.3.subject}}";

                var onClick = function(evt){
                        popup = new OpenLayers.Popup("chicken",
                          new OpenLayers.LonLat("{{p.point.x}}","{{p.point.y}}"),
                          new OpenLayers.Size(200,200),
                          new String("{{p.subject}}"),
                        true);
                        mapa.addPopup(popup);
               }

                marker = new OpenLayers.Marker(new OpenLayers.LonLat(x,y));
                marker.setOpacity(0.2);
                marker.events.register('mousedown', marker, onClick);
                markers.addMarker(marker);

            }

            {% endfor %}


            mapa.addControl(new OpenLayers.Control.LayerSwitcher());
           // mapa.zoomToMaxExtent();

            halfIcon.setOpacity(0.5);
        }


         function search(){
             var point_str = document.getElementById('point').value;
             var list = point_str.split(",");
             var x = parseFloat(list[0]);
             var y = parseFloat(list[1]);
             mapa.setCenter(new OpenLayers.LonLat(x, y), 10);
         }
    </script>

    

{% endblock %}

{% block body %}
 <body onload="init()">
    <div class = "Search" align="center">
        <input type="text" id ="point" size="40">
        <button type="button" onclick="search()">Search</button>

         <!--<form method=post action="" onsubmit="search()"
            <input type="text" id ="point" size="40">
            <input type="Submit" value="Search">
        </form>
        -->
    </div>

    <div id="mapa" class="smallmap" align="center"></div>
</body>
{% endblock %}